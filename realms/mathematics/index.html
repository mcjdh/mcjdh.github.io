<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>∴ ∑ ∴</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/ascii.css">
    <link rel="stylesheet" href="/css/symbols.css">
    <link rel="stylesheet" href="/css/navigation.css">
    <link rel="stylesheet" href="/css/harmonics.css">
</head>
<body>
    <div class="container">
        <div class="border">
            <div class="ascii-art">
╔═════════════════════════════════════════╗
║            ∑ ∏ ∫ ∂ ∇               ║
║                                         ║
║              ∞ = π²/6                 ║
╚═════════════════════════════════════════╝
            </div>
            
            <div class="symbol-grid">
                <a href="golden.html" class="symbol nav-link portal-trigger" 
                   data-portal="cosmos" data-connection="golden-spirals">φ</a>
                <a href="geometry.html" class="symbol nav-link portal-trigger" 
                   data-portal="glyphs" data-connection="sacred-geometry">△</a>
                <a href="constants.html" class="symbol nav-link portal-trigger" 
                   data-portal="cosmos" data-connection="universal-constants">π</a>
                <a href="infinity.html" class="symbol nav-link portal-trigger" 
                   data-portal="cosmos" data-connection="infinite-space">∞</a>
                <a href="fractals.html" class="symbol nav-link portal-trigger" 
                   data-portal="circuits" data-connection="recursive-algorithms">❋</a>
                <a href="primes.html" class="symbol nav-link portal-trigger" 
                   data-portal="circuits" data-connection="cryptography">ℙ</a>
                <a href="euler.html" class="symbol nav-link portal-trigger" 
                   data-portal="glyphs" data-connection="euler-identity">ℯ</a>
                <a href="matrices.html" class="symbol nav-link portal-trigger" 
                   data-portal="circuits" data-connection="linear-algebra">⊞</a>
            </div>
            
            <div class="ascii-art">
     1
    1 1
   1 2 1
  1 3 3 1
 1 4 6 4 1
1 5 10 10 5 1
            </div>
            
            <div class="divider">• • • • • • • • • • • • • • • •</div>
            
            <div class="navigation">
                <a href="/" class="nav-link">⟵</a>
                <a href="/" class="nav-link">◊</a>
                <a href="/realms/cosmos/" class="nav-link">✦</a>
            </div>
        </div>
    </div>
    
    <script src="/js/particles.js"></script>
    <script src="/js/quantum-particles.js"></script>
    <script src="/js/harmonics.js"></script>
    <script>
        // ♫ ∑ ∞
        window.harmonics.init();
        
        // ψ ∑ ∇
        const quantumField = window.quantumParticles.init([
            '∑', '∏', '∫', '∂', '∇', '∆', '∞', 'π', 'φ', 'θ', 'ℯ', 'ι', '∈', '∀', '∃'
        ]);
        
        // ○ ● ◉
        initParticles(['∑', '∏', '∫', '∂', '∇', '∆', '∞', 'π', 'φ', 'θ']);
        
        // ◊ ⟷ ◊
        document.querySelectorAll('.portal-trigger').forEach(trigger => {
            trigger.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                const portal = e.target.dataset.portal;
                const connection = e.target.dataset.connection;
                
                createCrossRealmPortal(portal, connection, e.clientX, e.clientY);
            });
            
            // ◉ ⟶ ◎
            let pressTimer;
            trigger.addEventListener('touchstart', (e) => {
                pressTimer = setTimeout(() => {
                    const portal = e.target.dataset.portal;
                    const connection = e.target.dataset.connection;
                    createCrossRealmPortal(portal, connection, 
                        e.touches[0].clientX, e.touches[0].clientY);
                }, 1000);
            });
            
            trigger.addEventListener('touchend', () => {
                clearTimeout(pressTimer);
            });
        });
        
        function createCrossRealmPortal(targetRealm, connection, x, y) {
            const portalDiv = document.createElement('div');
            portalDiv.className = 'cross-realm-portal';
            portalDiv.style.cssText = `
                position: fixed;
                left: ${x}px;
                top: ${y}px;
                transform: translate(-50%, -50%);
                z-index: 10000;
                font-size: 1.5rem;
                color: gold;
                text-shadow: 0 0 20px gold;
                animation: portal-open 1.618s ease-in-out;
                pointer-events: none;
            `;
            
            const portalSymbols = {
                cosmos: '✦ → ∞',
                glyphs: '☥ → △',
                circuits: '⌘ → ∑'
            };
            
            portalDiv.innerHTML = `
                <div style="text-align: center;">
                    <div>${portalSymbols[targetRealm] || '◊ → ◊'}</div>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                        ${connection.replace('-', '∴')}
                    </div>
                    <div style="font-size: 0.6rem; opacity: 0.7;">
                        ◊⟶${targetRealm}
                    </div>
                </div>
            `;
            
            document.body.appendChild(portalDiv);
            
            // Auto-navigate after animation
            setTimeout(() => {
                window.location.href = `/realms/${targetRealm}/`;
            }, 1618);
        }
        
        // ∑ π φ ℯ
        const constants = {
            'phi': window.harmonics.PHI,
            'pi': Math.PI,
            'e': Math.E,
            'tau': window.harmonics.TAU
        };
        
        // ∑ ⟷ ∇
        let mathExpression = '';
        document.addEventListener('keydown', (e) => {
            if (e.key.match(/[0-9+\-*/().phietau ]/)) {
                mathExpression += e.key;
                
                // Try to evaluate mathematical expressions
                if (mathExpression.length > 5 && e.key === 'Enter') {
                    try {
                        // π φ ℯ
                        let expr = mathExpression.toLowerCase();
                        Object.entries(constants).forEach(([name, value]) => {
                            expr = expr.replace(new RegExp(name, 'g'), value);
                        });
                        
                        const result = eval(expr);
                        showMathResult(expr, result);
                    } catch (error) {
                        // ∅ ∴ ∅
                    }
                    mathExpression = '';
                }
            } else if (e.key === 'Escape') {
                mathExpression = '';
            }
        });
        
        function showMathResult(expression, result) {
            const resultDiv = document.createElement('div');
            resultDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 1rem;
                border: 1px solid gold;
                border-radius: 5px;
                z-index: 1000;
                font-family: monospace;
            `;
            
            resultDiv.innerHTML = `
                <div>∑: ${expression}</div>
                <div>∴: ${result}</div>
                <div style="font-size: 0.8rem; opacity: 0.7; margin-top: 0.5rem;">
                    ⌨ → ∅
                </div>
            `;
            
            document.body.appendChild(resultDiv);
            
            const dismissHandler = () => {
                resultDiv.remove();
                document.removeEventListener('keydown', dismissHandler);
            };
            
            document.addEventListener('keydown', dismissHandler);
            
            setTimeout(() => {
                if (document.body.contains(resultDiv)) {
                    resultDiv.remove();
                    document.removeEventListener('keydown', dismissHandler);
                }
            }, 5000);
        }
        
        // △ᴾ ⟷ ◉
        document.querySelectorAll('.ascii-art').forEach(art => {
            if (art.textContent.includes('1 2 1')) {
                art.addEventListener('click', () => {
                    expandPascalsTriangle(art);
                });
            }
        });
        
        function expandPascalsTriangle(element) {
            const triangle = [
                [1],
                [1, 1],
                [1, 2, 1],
                [1, 3, 3, 1],
                [1, 4, 6, 4, 1],
                [1, 5, 10, 10, 5, 1],
                [1, 6, 15, 20, 15, 6, 1],
                [1, 7, 21, 35, 35, 21, 7, 1],
                [1, 8, 28, 56, 70, 56, 28, 8, 1]
            ];
            
            let triangleHTML = '';
            triangle.forEach((row, i) => {
                const spaces = ' '.repeat((triangle.length - i - 1) * 2);
                triangleHTML += spaces + row.join(' ') + '\n';
            });
            
            element.textContent = triangleHTML;
            
            // ℙ → ◈
            setTimeout(() => {
                element.innerHTML = triangleHTML.replace(/\b(\d+)\b/g, (match, num) => {
                    const n = parseInt(num);
                    if (window.harmonics.isPrime(n)) {
                        return `<span class="prime-number" data-prime="${num}">${num}</span>`;
                    }
                    return num;
                });
            }, 100);
        }
    </script>
</body>
</html>